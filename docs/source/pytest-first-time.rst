å…¥é–€ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
========================================

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã¨ä½•ãŒã„ã„ã®ã‹
----------------------------------------

* è‰¯ã„ã‚³ãƒ¼ãƒ‰ï¼ˆå¤‰æ›´ã—ã‚„ã™ã„ã€è¨€èªã®æ©Ÿèƒ½ã‚’å¼•ãå‡ºã—ã¦ã„ã‚‹ï¼‰ã« **è¿‘ã¥ã‘ã¦ã„ã**
* ä»Šã®å…¨éœŠã‚’ã‹ã‘ãŸã‚³ãƒ¼ãƒ‰ã ãŒã€ã‚ˆã‚Šã‚ˆã„æ›¸ãæ–¹ã‚’çŸ¥ã£ãŸã‚‰æ›¸ãæ›ãˆãŸã„

| å¤‰æ›´ã™ã‚‹ãŸã³ã«ã€å£Šã—ã¦ã„ãªã„ã‹ä¸å®‰
| å£Šã™ï¼æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã—ã¾ã†

3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

* ç¥ˆã‚‹ ğŸ™ğŸ™ã€Œã©ã†ã‹å¤‰ã‚ã£ã¦ã„ã¾ã›ã‚“ã‚ˆã†ã«ã€ğŸ™ğŸ™

    * ä¸å®‰ã ã‘ã©ç¢ºèªã¯ã—ãªã„

* æ‰‹ã§å‹•ä½œç¢ºèª âœ‹

    * å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§importã—ã¦å‹•ä½œç¢ºèª
    * ç¢ºèªã™ã‚‹ã®ã§å®‰å¿ƒã§ãã‚‹ãŒã€é–¢æ•°ã®æ•°ãŒå¢—ãˆã‚‹ã¨ç¾å®Ÿçš„ã§ãªã„

* ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèª ğŸ¤–ï¼ˆè‡ªå‹•ãƒ†ã‚¹ãƒˆï¼‰

    * ã€Œæ‰‹ã§å‹•ä½œç¢ºèªã€ã®è‡ªå‹•åŒ–
    * ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ä½¿ã†éƒ¨å“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèªï¼ˆã¡ã‚‡ã†ãœã¤æœ¬ï¼‰
    * è‡ªå‹•åŒ–ã—ã¦ã„ã‚‹ã®ã§ç¹°ã‚Šè¿”ã—ç¢ºèªã§ãã‚‹

| è‡ªå‹•ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šã€å¤‰æ›´ã—ã¦æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã„ãªã„ã‹ã¨ã„ã†ä¸å®‰ã¯ **é€€å±ˆ** ã«å¤‰ã‚ã‚‹
| ã€Œè‡ªå‹•ãƒ†ã‚¹ãƒˆãŒ1ã¤ã‚‚å¤±æ•—ã—ã¦ã„ãªã„ã‹ã‚‰æŒ¯ã‚‹èˆã„ã¯å¤‰ã‚ã£ã¦ãªã„ï¼ã€ï¼ˆ*å›å¸°ãƒ†ã‚¹ãƒˆ*ï¼‰

| ã“ã®ãƒ†ã‚¹ãƒˆã¯é–‹ç™ºè€…ã®ãŸã‚ã®ã‚‚ã®ï¼ˆé–‹ç™ºä¸­ã«è‡ªä¿¡ã‚’æŒã¦ã‚‹ï¼‰
| å“è³ªä¿è¨¼ã®ãŸã‚ã®ãƒ†ã‚¹ãƒˆã¯åˆ¥ã«å¿…è¦ã§ã™

IMOï¼šãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰æ›¸ã‹ãªã„ãªã‚“ã¦ã€ *ã‚‚ã£ãŸã„ãªã„* ã§ã™ã‚ˆ

``assert`` æ–‡
--------------------

:å‰æ: :file:`start` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã„ã¾ã™

å¯¾è©±ãƒ¢ãƒ¼ãƒ‰

.. code-block:: pycon

    >>> assert True
    >>> assert False
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    AssertionError

.. code-block:: pycon
    :caption: ``True`` ã¨è©•ä¾¡ã•ã‚Œã‚‹å¼ã¨ ``assert``

    >>> 1 == 1
    True
    >>> assert 1 == 1

.. code-block:: pycon
    :caption: ``False`` ã¨è©•ä¾¡ã•ã‚Œã‚‹å¼ã¨ ``assert``

    >>> 1 == 2
    False
    >>> assert 1 == 2
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    AssertionError

æ›¸ã„ã¦ã¿ã¦ç·´ç¿’ã—ã‚ˆã†ï¼ˆåˆ¥ã®æ•°å­—ã€åˆ¥ã®å‹ï¼‰

.. note:: assertæ–‡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

    è¨€èªãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ `7.3. assert æ–‡ <https://docs.python.org/ja/3/reference/simple_stmts.html#the-assert-statement>`__

.. note:: è¡¨æ˜ãªã‚‹ã‚‚ã®

    ã€Œ``assert`` ã£ã¦ï¼ˆpytestã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä»¥å¤–ã§ï¼‰ã©ã“ã§ä½¿ã†ã®ï¼Ÿã€ã¨æ€ã£ãŸæ–¹ã¸

    .. raw:: html

        <iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 420;" frameborder="0" src="https://speakerdeck.com/player/68b40ca9983a48dc9efec540ab98f88d?slide=69" title="PHP7 ã§å …ç‰¢ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã - ä¾‹å¤–å‡¦ç†ã€è¡¨æ˜ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€å¥‘ç´„ã«ã‚ˆã‚‹è¨­è¨ˆ / PHP Conference 2016" allowfullscreen="true" data-ratio="1.3333333333333333"></iframe>

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
--------------------

pytestã¯

* ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã
* ``assert`` ã‚’ä½¿ã£ã¦é–¢æ•°ã‚’æ›¸ãï¼ˆå¾Œè¿°ï¼‰

ç¾åœ¨

.. code-block::

    start/
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ fizzbuzz/
    â”‚       â”œâ”€â”€ __init__.py
    â”‚       â””â”€â”€ core.py
    â”œâ”€â”€ tests/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ test_practice.py
    â””â”€â”€ pyproject.toml

ã“ã®ã‚ˆã†ã«è‚²ã¡ã¾ã™ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼‰

.. code-block::

    start/
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ fizzbuzz/
    â”‚       â”œâ”€â”€ __init__.py
    â”‚       â””â”€â”€ core.py
    â”œâ”€â”€ tests/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ test_core.py
    â”‚   â””â”€â”€ test_fizzbuzz.py
    â””â”€â”€ pyproject.toml

| å½±éŸ¿ `unittestã§å§‹ã‚ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå…¥é–€ (PyCon JP 2019) <https://pycon.jp/2019/schedule/?sessionId=213>`__
| https://docs.google.com/presentation/d/1F0fkcbuuQBCbVDLD2v8YQlMOqEMnF_PpI2AAR5nwhfI/edit#slide=id.g628217d75a_0_0

.. note:: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ src-layout

    :file:`src` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ã‚„ã‚Šæ–¹ã€‚OSSã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã“ã¡ã‚‰ãŒä¸»æµ

    `src ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¯¾ãƒ•ãƒ©ãƒƒãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ <https://packaging.python.org/ja/latest/discussions/src-layout-vs-flat-layout/>`__

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
--------------------

ãƒ†ã‚¹ãƒˆãŒ1ã¤ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

.. literalinclude:: ../../start/tests/test_practice.py
    :language: python

ã“ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

:command:`pytest`

.. code-block:: shell

    (.venv) $ pytest
    ================================== test session starts ==================================
    platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0
    rootdir: /.../first-python-test-2024/start
    configfile: pyproject.toml
    collected 1 item                                                                        

    tests/test_practice.py F                                                          [100%]

    ======================================= FAILURES ========================================
    _____________________________________ test_ç’°å¢ƒæ§‹ç¯‰ã®ç¢ºèª ______________________________________

        def test_ç’°å¢ƒæ§‹ç¯‰ã®ç¢ºèª():
    >       assert False
    E       assert False

    tests/test_practice.py:2: AssertionError
    ================================ short test summary info ================================
    FAILED tests/test_practice.py::test_ç’°å¢ƒæ§‹ç¯‰ã®ç¢ºèª - assert False
    =================================== 1 failed in 0.02s ===================================

ç”¨èªç´¹ä»‹

:pass: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ï¼ˆã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã€‚pytestã§ã¯ . ãŒä¸¦ã¶ï¼‰
:fail: ãƒ†ã‚¹ãƒˆãŒè½ã¡ã‚‹ï¼ˆ1ã¤ã§ã‚‚ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã€‚Fï¼ˆã‚„Eï¼‰ãŒ1ã¤ä»¥ä¸Šã‚ã‚‹ï¼‰

ä½•ã‚’ã—ãŸã®ã‹
--------------------

* :command:`pytest` ã¨å®Ÿè¡Œã—ãŸã‚‰ ``test_ç’°å¢ƒæ§‹ç¯‰ã®ç¢ºèª`` ãŒè½ã¡ãŸ
* ``assert False`` ã¨æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€è½ã¡ã‚‹ã®ã¯å½“ç„¶
* ãªãœã“ã‚“ãªã“ã¨ã‚’ã—ãŸï¼Ÿ

``assert False`` ã§è½ã¡ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‹ã£ãŸ

* ç’°å¢ƒæ§‹ç¯‰ã«å¤±æ•—ã—ãŸã‚‰ä»–ã®ã¨ã“ã‚ã§è½ã¡ã‚‹
* ç’°å¢ƒæ§‹ç¯‰ã§ãã¦ã„ã‚‹ã‹ã‚‰ ``assert False`` ã§è½ã¡ã‚‹

``assert True`` ã«æ›¸ãæ›ãˆãŸã‚‰ï¼Ÿ -> é€šã‚‹ï¼ğŸ™Œ

.. code-block:: shell

    (.venv) $ pytest
    ================================== test session starts ==================================
    platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0
    rootdir: /.../first-python-test-2024/start
    configfile: pyproject.toml
    collected 1 item                                                                        

    tests/test_practice.py .                                                          [100%]

    =================================== 1 passed in 0.01s ===================================

| æº–å‚™ãŒã§ãã¾ã—ãŸï¼
| :file:`tests/test_practice.py` ã¯ç’°å¢ƒæ§‹ç¯‰ã®ç¢ºèªã®ãŸã‚ã®ã‚‚ã®ãªã®ã§æ¶ˆã—ã¦æ§‹ã„ã¾ã›ã‚“

.. note:: ``assert False`` ã§å§‹ã‚ã‚‹å„€å¼

    æ‹™ãƒ–ãƒ­ã‚°ã‚ˆã‚Š `assert Falseã§å§‹ã‚ã‚‹å„€å¼ <https://nikkie-ftnext.hatenablog.com/entry/stapy-88-yattom-san-talk-pytest#assert-False%E3%81%A7%E5%A7%8B%E3%82%81%E3%82%8B%E5%84%80%E5%BC%8F>`__

    æœ€åˆã¯pytestã®å°å…¥ã§ã¤ã¾ã¥ãã“ã¨ã‚‚ã‚ã£ãŸã®ã§ã€æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã“ã®å„€å¼ã‚’ã—ã¦ã¾ã—ãŸ
